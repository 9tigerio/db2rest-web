---
sidebar_position: 2
---

# Bulk Insert

DB2Rest supports adding multiple rows in a table per request. This is useful in the following scenarios:

    1. Data migration / Batch processing - Insert large data-set in chunks of 'n' records. Ex - file processing.
    2. Front end multi row inserts - application can create records of same type - Order containing Line items.


## Example Request

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

<Tabs>
    <TabItem value="cURL" label="cURL" default>
        ```bash
        $ curl 'http://localhost:8080/film/bulk' -i -X POST \
        -H 'Content-Type: application/json' \
        -H 'Accept: application/json' \
        -d ' [
        {
            "title" : "Dunki",
            "description" : "Film about illegal immigration" ,
            "release_year" : 2023,
            "language_id" : 6,
            "original_language_id" : 6,
            "rental_duration" : 6,
            "rental_rate" : 0.99 ,
            "length" : 150,
            "replacement_cost" : 20.99 ,
            "rating" : "PG-13" ,
            "special_features" : "Commentaries"

        },

        {
            "title" : "Jawan",
            "description" : "Socio-econmic problems and corruption" ,
            "release_year" : 2023,
            "language_id" : 6,
            "original_language_id" : 6,
            "rental_duration" : 5,
            "rental_rate" : 0.99 ,
            "length" : 160,
            "replacement_cost" : 20.99 ,
            "rating" : "PG-13" ,
            "special_features" : "Commentaries"

        }
        ]
        '
        ```
    </TabItem>
    <TabItem value="httpie" label="HTTPie">
        ```http
        POST /film/bulk HTTP/1.1
        Content-Type: application/json
        Accept: application/json
        Content-Length: 896
        Host: localhost:8080

        [
        {
            "title" : "Dunki",
            "description" : "Film about illegal immigration" ,
            "release_year" : 2023,
            "language_id" : 6,
            "original_language_id" : 6,
            "rental_duration" : 6,
            "rental_rate" : 0.99 ,
            "length" : 150,
            "replacement_cost" : 20.99 ,
            "rating" : "PG-13" ,
            "special_features" : "Commentaries"

        },

        {
            "title" : "Jawan",
            "description" : "Socio-econmic problems and corruption" ,
            "release_year" : 2023,
            "language_id" : 6,
            "original_language_id" : 6,
            "rental_duration" : 5,
            "rental_rate" : 0.99 ,
            "length" : 160,
            "replacement_cost" : 20.99 ,
            "rating" : "PG-13" ,
            "special_features" : "Commentaries"

        }
        ]

        ```
    </TabItem>

</Tabs>


:::tip Content Profile Header

A schema name is required for insert operation. This is supplied using the *'Content-Profile'* header as shown in the example
above.

:::


## HTTP Response

<Tabs>
    <TabItem value="pg" label="PostgreSQL" default>
        ```http
        HTTP/1.1 201 Created
        Content-Type: application/json
        Content-Length: 16

        {"rows":[-2,-2]}
        ```



    </TabItem>
    <TabItem value="mysql" label="MySQL">
        ```http
        HTTP/1.1 201 Created
        Content-Type: application/json
        Content-Length: 14

        {"rows":[1,1]}
        ```
    </TabItem>

</Tabs>


On successful creation of the rows in the table, DB2Rest responds with HTTP code 201. The response payload has an
attribute `rows`. It is an array containing the numbers of rows affected by each insert statement in the batch.

:::info

The `rows` attribute may also contain special JDBC-defined negative values for affected
rows such as

    - (Statement.SUCCESS_NO_INFO = -2)[https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/java/sql/Statement.html#SUCCESS_NO_INFO]
    - (Statement.EXECUTE_FAILED = -3)[https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/java/sql/Statement.html#EXECUTE_FAILED]
:::


## Error handling

The following request will result in an error as the column 'country' is not part of he 'film' table.

```bash
$ curl 'http://localhost:8080/film/bulk' -i -X POST \
    -H 'Content-Type: application/json;charset=utf-8' \
    -H 'Content-Profile: public' \
    -H 'Accept: application/json' \
    -d ' [
       {
           "title" : "Dunki",
            "description" : "Film about illegal immigration" ,
            "release_year" : 2023,
            "language_id" : 6,
            "original_language_id" : 6,
            "rental_duration" : 6,
            "rental_rate" : 0.99 ,
            "length" : 150,
            "replacement_cost" : 20.99 ,
            "rating" : "PG-13" ,
            "special_features" : "Commentaries"
            "country" : "INDIA"

        },

       {
           "title" : "Jawan",
            "description" : "Socio-econmic problems and corruption" ,
            "release_year" : 2023,
            "language_id" : 6,
            "original_language_id" : 6,
            "rental_duration" : 5,
            "rental_rate" : 0.99 ,
            "length" : 160,
            "replacement_cost" : 20.99 ,
            "rating" : "PG-13" ,
            "special_features" : "Commentaries"

        }
    ]
'
```

This will result in error response with HTTP status code 400 as shown in the listing below.

```json
{
  "type":"https://github.com/kdhrubo/db2rest/generic-error",
  "title":"Generic Data Access Error",
  "status":400,
  "detail":"ERROR: column \"country\" of relation \"film\" does not exist\n  Position: 170",
  "instance":"/film",
  "errorCategory":"Data-access-error",
  "timestamp":"2024-01-13T03:42:36.504095Z"
}
```

## Transaction Management

In the error scenario above, the second record has error. However, DB2Rest will reject both records and nothing
gets saved in the database. This is because DB2Rest handles [ACID](https://en.wikipedia.org/wiki/ACID) transaction properties.
This ensures either the entire batch is saved or nothing is saved.

:::info

DB2Rest co-ordinates transaction management with the database. It is applicable for both single and multiple records.
In both cases DB2Rest ensures data is rolled back in case of an error.

:::
